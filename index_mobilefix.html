<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Revelador Pro - Experiencia Inmersiva</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --cursor-x: 50%;
            --cursor-y: 50%;
            --current-radius: 0px; 
            --accent-color: 255, 255, 255;
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #050505;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            user-select: none;
            -webkit-user-select: none;
        }

        .app-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            cursor: none;
            touch-action: none; 
            overflow: hidden;
        }

        /* Capa de Fondo con Grano - Ajustada para mayor visibilidad y sin zoom */
        .top-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://lh3.googleusercontent.com/pw/AP1GczNUMpUSaIHpGvGWnEMFMdVH6EBBhVwqI5a9CblCACWZ9NpvsxfTL7OujELcTglDVW6NynFUlMIwqUKZjy84A1gSz431YhyUyI2JTDCjhcy3CpMjpSTsqx1sDOXWDFOw-N_TPxOwUC7YBJNRWdPLe6d5IA=w854-h1518-s-no-gm?authuser=0');
            background-size: cover;
            background-position: center;
            filter: grayscale(100%) brightness(45%) contrast(110%);
            z-index: 1;
        }

        .grain-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            opacity: 0.04;
            pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3%3Cfilter id='noiseFilter'%3%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        /* Capa Revelada */
        .flowers-spotlight {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('cristina_2.jpg');
            background-size: cover;
            background-position: center;
            z-index: 3;
            pointer-events: none;
            clip-path: circle(var(--current-radius) at var(--cursor-x) var(--cursor-y));
            will-change: clip-path;
        }

        /* Resplandor del foco */
        .spotlight-glow {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 4;
            pointer-events: none;
            background: radial-gradient(
                circle var(--current-radius) at var(--cursor-x) var(--cursor-y), 
                rgba(var(--accent-color), 0.15) 0%, 
                rgba(var(--accent-color), 0.05) 80%,
                transparent 100%
            );
        }

        /* Canvas de Partículas */
        #particle-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            pointer-events: none;
        }

        /* UI Styling */
        .glass-panel {
            background: rgba(10, 10, 10, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        .controls-container {
            position: fixed;
            top: 24px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            width: 90%;
            max-width: 440px;
            transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .controls-container.is-active {
            opacity: 0.1;
            transform: translateX(-50%) translateY(-10px) scale(0.98);
        }

        .btn-action {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px;
            border-radius: 12px;
            color: white;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            transition: all 0.3s;
            flex: 1;
        }

        .btn-action:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }

        input[type="range"]::-webkit-slider-runnable-track {
            width: 100%;
            height: 2px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #ffffff;
            margin-top: -7px;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        .hint {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            color: rgba(255,255,255,0.6);
            font-size: 12px;
            letter-spacing: 2px;
            text-transform: uppercase;
            pointer-events: none;
            text-align: center;
        }

        /* Cursor Custom */
        .custom-cursor {
            position: fixed;
            width: 20px;
            height: 20px;
            border: 1px solid white;
            border-radius: 50%;
            pointer-events: none;
            z-index: 999;
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s, background 0.3s;
        }

        .custom-cursor.active {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.1);
        }
    </style>
</head>
<body>

    <div class="custom-cursor" id="cursor"></div>

    <div class="controls-container glass-panel p-4 rounded-2xl flex flex-col gap-4" id="ui">
        <div class="flex gap-2">
            <label class="btn-action cursor-pointer">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                Fondo
                <input type="file" id="up-top" accept="image/*" class="hidden">
            </label>
            <label class="btn-action cursor-pointer">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                Foco
                <input type="file" id="up-bottom" accept="image/*" class="hidden">
            </label>
        </div>
        <div class="flex items-center gap-4 px-2">
            <span class="text-[10px] text-white/50 uppercase tracking-widest">Apertura</span>
            <input type="range" id="size-slider" min="60" max="400" value="250">
        </div>
    </div>

    <div class="app-container" id="stage">
        <div class="top-layer" id="layer-bg"></div>
        <div class="grain-overlay"></div>
        <div class="flowers-spotlight" id="spotlight"></div>
        <div class="spotlight-glow" id="glow"></div>
        <canvas id="particle-canvas"></canvas>
        
        <div class="hint" id="hint">
            Mantén o pulsa para revelar
        </div>
    </div>

    <script>
        const stage = document.getElementById('stage');
        const spotlight = document.getElementById('spotlight');
        const ui = document.getElementById('ui');
        const cursor = document.getElementById('cursor');
        const canvas = document.getElementById('particle-canvas');
        const ctx = canvas.getContext('2d');

        // Estado
        let state = {
            targetX: window.innerWidth / 2,
            targetY: window.innerHeight / 2,
            currentX: window.innerWidth / 2,
            currentY: window.innerHeight / 2,
            maxRadius: 250,
            currentRadius: 0,
            isPressed: false,
            isLocked: false,
            particles: []
        };

        // Configuración de partículas
        class Particle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.size = Math.random() * 2 + 0.5;
                this.speedX = (Math.random() - 0.5) * 2;
                this.speedY = (Math.random() - 0.5) * 2;
                this.life = 1;
                this.decay = Math.random() * 0.02 + 0.005;
            }
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                this.life -= this.decay;
            }
            draw() {
                ctx.fillStyle = `rgba(255, 255, 255, ${this.life * 0.5})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        const lerp = (a, b, n) => (1 - n) * a + n * b;

        function animate() {
            // Suavizado de posición
            state.currentX = lerp(state.currentX, state.targetX, 0.15);
            state.currentY = lerp(state.currentY, state.targetY, 0.15);

            // Lógica de radio
            const targetR = (state.isPressed || state.isLocked) ? state.maxRadius : 0;
            state.currentRadius = lerp(state.currentRadius, targetR, 0.1);

            // Aplicar CSS
            stage.style.setProperty('--cursor-x', `${state.currentX}px`);
            stage.style.setProperty('--cursor-y', `${state.currentY}px`);
            stage.style.setProperty('--current-radius', `${state.currentRadius}px`);

            // Cursor visual
            cursor.style.left = `${state.currentX}px`;
            cursor.style.top = `${state.currentY}px`;

            // Partículas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (state.currentRadius > 20) {
                // Crear nuevas partículas cerca del foco
                if (Math.random() > 0.7) {
                    const angle = Math.random() * Math.PI * 2;
                    const dist = Math.random() * state.currentRadius;
                    state.particles.push(new Particle(
                        state.currentX + Math.cos(angle) * dist,
                        state.currentY + Math.sin(angle) * dist
                    ));
                }
            }

            state.particles.forEach((p, i) => {
                p.update();
                p.draw();
                if (p.life <= 0) state.particles.splice(i, 1);
            });

            // Opacidad de la UI e instrucciones
            ui.classList.toggle('is-active', state.currentRadius > 50);
            document.getElementById('hint').style.opacity = lerp(parseFloat(document.getElementById('hint').style.opacity || 1), state.currentRadius > 20 ? 0 : 1, 0.1);

            requestAnimationFrame(animate);
        }

        animate();

        // Interacciones (unificadas con Pointer Events: funciona igual en desktop y mobile)
const getPoint = (e) => {
    // PointerEvent / MouseEvent
    if (typeof e.clientX === 'number' && typeof e.clientY === 'number') {
        return { x: e.clientX, y: e.clientY };
    }
    // TouchEvent fallback
    if (e.touches && e.touches[0]) {
        return { x: e.touches[0].clientX, y: e.touches[0].clientY };
    }
    if (e.changedTouches && e.changedTouches[0]) {
        return { x: e.changedTouches[0].clientX, y: e.changedTouches[0].clientY };
    }
    return null;
};

const updatePos = (e) => {
    const p = getPoint(e);
    if (!p) return;
    state.targetX = p.x;
    state.targetY = p.y;
};

let pressStartTime = 0;
let pressStartX = 0;
let pressStartY = 0;
let movedDuringPress = false;

const TAP_MS = 180;      // tap rápido -> alterna bloqueo
const MOVE_PX = 10;      // tolerancia de movimiento para considerar "tap"

const onPressStart = (e) => {
    if (e.target.closest('.glass-panel')) return;

    // En mobile evita scroll/zoom por gesto mientras interactúas
    if (e.cancelable) e.preventDefault();

    updatePos(e);
    state.isPressed = true;
    cursor.classList.add('active');

    const p = getPoint(e);
    pressStartTime = performance.now();
    pressStartX = p ? p.x : state.targetX;
    pressStartY = p ? p.y : state.targetY;
    movedDuringPress = false;

    // Captura el puntero para seguir recibiendo move aunque el dedo salga del elemento
    if (typeof stage.setPointerCapture === 'function' && e.pointerId != null) {
        try { stage.setPointerCapture(e.pointerId); } catch (_) {}
    }
};

const onPressMove = (e) => {
    if (!state.isPressed && !state.isLocked) return;
    if (e.cancelable) e.preventDefault();

    const p = getPoint(e);
    if (p) {
        const dx = p.x - pressStartX;
        const dy = p.y - pressStartY;
        if ((dx*dx + dy*dy) > (MOVE_PX*MOVE_PX)) movedDuringPress = true;
    }
    updatePos(e);
};

const onPressEnd = (e) => {
    if (e.cancelable) e.preventDefault();

    // Tap rápido (sin arrastre) -> alterna bloqueo, igual que en desktop
    const elapsed = performance.now() - pressStartTime;
    if (state.isPressed && elapsed <= TAP_MS && !movedDuringPress) {
        state.isLocked = !state.isLocked;
    }

    state.isPressed = false;
    cursor.classList.remove('active');
};

// Pointer Events (preferido)
stage.addEventListener('pointerdown', onPressStart, { passive: false });
stage.addEventListener('pointermove', onPressMove, { passive: false });
window.addEventListener('pointerup', onPressEnd, { passive: false });
window.addEventListener('pointercancel', onPressEnd, { passive: false });

// Mouse move (mantiene el tracking “hover” cuando no estás pulsando)
window.addEventListener('mousemove', updatePos);

// Fallback iOS antiguo / navegadores sin Pointer Events
window.addEventListener('touchstart', onPressStart, { passive: false });
window.addEventListener('touchmove', onPressMove, { passive: false });
window.addEventListener('touchend', onPressEnd, { passive: false });
window.addEventListener('touchcancel', onPressEnd, { passive: false });

// Sliders y Archivos
        document.getElementById('size-slider').addEventListener('input', (e) => {
            state.maxRadius = parseInt(e.target.value);
        });

        function setupFile(id, target) {
            document.getElementById(id).addEventListener('change', function() {
                const file = this.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => target.style.backgroundImage = `url('${e.target.result}')`;
                    reader.readAsDataURL(file);
                }
            });
        }

        setupFile('up-top', document.getElementById('layer-bg'));
        setupFile('up-bottom', spotlight);
    </script>
</body>
</html>
